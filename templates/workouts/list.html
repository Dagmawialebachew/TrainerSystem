{% extends 'list_base.html' %}

{% block list_title %}
<i class="fas fa-dumbbell text-primary-500 mr-2"></i>Workout Plans
{% endblock %}

{% block header_actions %}
<div class="flex flex-wrap gap-4 mt-6">
<a href="{% url 'workouts:create' %}" 
   class="bg-gradient-to-r from-primary-600 to-primary-400 text-white px-6 py-2 rounded-xl font-semibold shadow-lg hover:scale-105 transition transform flex items-center space-x-2">
    <i class="fas fa-dumbbell"></i>
    <span>Create Plan</span>
</a>

<a href="{% url 'workouts:exercise_list' %}"
     class="inline-flex items-center space-x-2 px-6 py-2 rounded-xl font-semibold shadow-lg transition transform hover:scale-105
            bg-gradient-to-r from-warning-600 to-warning-400 text-white">
    <i class="fas fa-running text-white"></i>
    <span>See Exercise List</span>
  </a>

   <a href="{% url 'workouts:exercise_add' %}"
     class="inline-flex items-center space-x-2 px-6 py-2 rounded-xl font-semibold shadow-lg transition transform hover:scale-105
            bg-gradient-to-r from-success-600 to-success-400 text-white">
    <i class="fas fa-plus-square text-white"></i>
    <span>Add Exercise</span>
  </a>

  </div>
{% endblock %}

{% block cards_view %}
{% for plan in workout_plans %}
<div class="relative w-full max-w-sm mx-auto">

  <!-- Card -->
  <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center w-full h-full transition duration-300 hover:shadow-xl">

    <!-- Avatar -->
    {% if plan.client.user.profile_picture %}
      <img class="h-20 w-20 rounded-full object-cover border-4 border-primary-100 shadow-md ring-2 ring-offset-2 ring-primary-300 hover:ring-primary-500 transition duration-300" 
           src="{{ plan.client.user.profile_picture.url }}">
    {% else %}
      <div class="h-20 w-20 bg-primary-100 rounded-full flex items-center justify-center text-primary-600 font-bold text-xl shadow-inner">
        {{ plan.client.user.first_name.0 }}{{ plan.client.user.last_name.0 }}
      </div>
    {% endif %}

    <!-- Title & Client -->
    <h3 class="mt-4 text-lg font-semibold text-primary-900 text-center">{{ plan.title }}</h3>
    <p class="text-sm text-primary-500">Client: {{ plan.client.user.get_full_name }}</p>

    <!-- Tags -->
    <div class="mt-2 flex flex-wrap justify-center gap-2 text-xs font-medium">
      <span class="bg-primary-100 text-primary-700 px-2 py-1 rounded-full">
        <i class="fas fa-signal mr-1"></i>{{ plan.get_difficulty_display }}
      </span>
      <span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full">
        <i class="fas fa-calendar-week mr-1"></i>{{ plan.duration_weeks }} weeks
      </span>
    </div>

    <!-- Mini Structure Preview -->
    {% if plan.workout_structure %}
    <div class="mt-4 w-full text-left text-sm text-primary-700">
      <p class="font-semibold mb-1"><i class="fas fa-stream mr-1"></i>Structure Preview:</p>
      <ul class="list-disc list-inside text-xs space-y-1">
        {% for block in plan.workout_structure|slice:":2" %}
          <li>{{ block.day }} â€“ {{ block.exercises|length }} exercise{% if block.exercises|length > 1 %}s{% endif %}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    <!-- Action Buttons -->
    <div class="mt-5 grid grid-cols-2 gap-2 w-full text-xs font-medium">
      <a href="{{ plan.get_absolute_url }}" class="btn-icon bg-success-500 text-white">
        <i class="fas fa-eye mr-1"></i> View
      </a>
      <a href="{% url 'workouts:edit' plan.pk %}" class="btn-icon bg-warning-500 text-white">
        <i class="fas fa-edit mr-1"></i> Edit
      </a>
      <a href="{% url 'workouts:delete' plan.pk %}" class="btn-icon bg-danger-500 text-white">
        <i class="fas fa-trash mr-1"></i> Delete
      </a>
      <a href="{% url 'trainers:client_detail' plan.client.pk %}" class="btn-icon bg-blue-500 text-white">
        <i class="fas fa-user mr-1"></i> Client
      </a>
    </div>
  </div>
</div>
{% empty %}
<div class="col-span-full text-center py-12">
  <i class="fas fa-dumbbell text-4xl text-primary-300 mb-4"></i>
  <p class="text-lg text-primary-500">No workout plans yet</p>
  <a href="{% url 'workouts:create' %}" class="mt-2 inline-block text-primary-600 hover:underline">
    Create your first plan
  </a>
</div>
{% endfor %}
{% endblock %}


{% block table_view %}
<div class="overflow-x-auto mt-6">
  <div class="inline-block min-w-full align-middle">
    <div class="overflow-hidden shadow-xl ring-1 ring-black/5 rounded-2xl bg-white">
      <table class="min-w-full divide-y divide-gray-200">
        <!-- Header -->
        <thead class="bg-gradient-to-r from-primary-50 to-primary-100">
          <tr>
            <th class="px-6 py-4 text-left text-xs font-semibold text-primary-700 uppercase tracking-wider">
              <i class="fas fa-heading mr-2"></i>Title
            </th>
            <th class="px-6 py-4 text-left text-xs font-semibold text-primary-700 uppercase tracking-wider">
              <i class="fas fa-user mr-2"></i>Client
            </th>
            <th class="px-6 py-4 text-left text-xs font-semibold text-primary-700 uppercase tracking-wider">
              <i class="fas fa-signal mr-2"></i>Difficulty
            </th>
            <th class="px-6 py-4 text-left text-xs font-semibold text-primary-700 uppercase tracking-wider">
              <i class="fas fa-clock mr-2"></i>Duration
            </th>
            <th class="px-6 py-4 text-left text-xs font-semibold text-primary-700 uppercase tracking-wider">
              <i class="fas fa-tools mr-2"></i>Actions
            </th>
          </tr>
        </thead>

        <!-- Body -->
        <tbody class="divide-y divide-gray-100 bg-white">
          {% for plan in workout_plans %}
          <tr class="hover:bg-primary-50/60 transition-colors duration-200">
            <!-- Title -->
            <td class="px-6 py-4 font-medium text-gray-900">{{ plan.title }}</td>

            <!-- Client -->
            <td class="px-6 py-4 text-sm text-gray-600">
              {{ plan.client.user.get_full_name }}
            </td>

            <!-- Difficulty -->
            <td class="px-6 py-4 text-sm">
              <span class="px-2 py-1 rounded-full text-xs font-medium 
                {% if plan.difficulty == 'easy' %} bg-green-100 text-green-700
                {% elif plan.difficulty == 'medium' %} bg-yellow-100 text-yellow-700
                {% elif plan.difficulty == 'hard' %} bg-red-100 text-red-700
                {% else %} bg-gray-100 text-gray-600 {% endif %}">
                {{ plan.get_difficulty_display }}
              </span>
            </td>

            <!-- Duration -->
            <td class="px-6 py-4 text-sm text-gray-600">
              {{ plan.duration_weeks }} weeks
            </td>

            <!-- Actions -->
            <td class="px-6 py-4 flex flex-wrap gap-3">
              <a href="{{ plan.get_absolute_url }}" 
                 class="flex items-center gap-1 text-success-600 hover:text-success-700 transition">
                <i class="fas fa-eye"></i><span class="hidden sm:inline">View</span>
              </a>
              <a href="{% url 'workouts:edit' plan.pk %}" 
                 class="flex items-center gap-1 text-warning-600 hover:text-warning-700 transition">
                <i class="fas fa-edit"></i><span class="hidden sm:inline">Edit</span>
              </a>
              <a href="{% url 'workouts:delete' plan.pk %}" 
                 class="flex items-center gap-1 text-danger-600 hover:text-danger-700 transition">
                <i class="fas fa-trash"></i><span class="hidden sm:inline">Delete</span>
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="px-6 py-8 text-center text-gray-400">
              <i class="fas fa-dumbbell mr-2"></i>No workout plans found. 
              <a href="{% url 'workouts:create' %}" class="text-primary-600 hover:underline">Create one</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}



{% block pagination %}
{% if is_paginated %}
<div class="flex justify-center mt-6 space-x-2 text-sm">
  {% if page_obj.has_previous %}
  <a href="?page={{ page_obj.previous_page_number }}" class="px-3 py-1 border rounded-md hover:bg-primary-50">&laquo; Prev</a>
  {% endif %}
  <span class="px-3 py-1 border rounded-md bg-primary-100 text-primary-700 font-semibold">{{ page_obj.number }}</span>
  {% if page_obj.has_next %}
  <a href="?page={{ page_obj.next_page_number }}" class="px-3 py-1 border rounded-md hover:bg-primary-50">Next &raquo;</a>
  {% endif %}
</div>
{% endif %}
{% endblock %}