{% extends 'form_base.html' %}
{% load widget_tweaks %}

{% block title %}Add Progress{% endblock %}

{% block back_url %}
    {% if user.is_client %}
    {% url 'clients:progress' %}
    {% elif user.is_trainer %}
    {% url 'progress:list' %}
    {% endif %}
{% endblock %}

{% block form_title %}
  {% if user.is_trainer %}
    Add Progress for {{ client.user.get_full_name }}
  {% else %}
    Log Your Progress
  {% endif %}
  
{% endblock %}

{% block form_method %}post{% endblock %}
{% block form_enctype %}multipart/form-data{% endblock %}

{% block form_fields %}
<div class="space-y-6">

  <!-- Date -->
  <div class="flex flex-col mb-4">
    <label class="block text-sm font-medium text-primary-800 mb-1">Date</label>
    {{ form.date }}
    {% if form.date.errors %}
        <p class="text-sm text-warning-700 mt-1">{{ form.date.errors|join:", " }}</p>
    {% endif %}
  </div>

  <!-- 1. Adherence Section -->
  <div class="bg-white shadow-lg rounded-2xl p-6 hover:shadow-xl transition">
    <h3 class="text-lg font-semibold text-primary-900 mb-4"><i class="fas fa-check-circle mr-2"></i>Success Rate</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="flex items-center">
        {{ form.workout_completed|add_class:"form-checkbox h-5 w-5 text-primary-600" }}
        <label class="ml-2 text-sm font-medium text-gray-700">Workout Completed</label>
      </div>
      <div class="flex items-center">
        {{ form.meal_plan_followed|add_class:"form-checkbox h-5 w-5 text-primary-600" }}
        <label class="ml-2 text-sm font-medium text-gray-700">Meal Plan Followed</label>
      </div>
    </div>
    {% if form.workout_completed.errors or form.meal_plan_followed.errors %}
      <p class="text-sm text-warning-700 mt-2">{{ form.workout_completed.errors|join:", " }} {{ form.meal_plan_followed.errors|join:", " }}</p>
    {% endif %}
  </div>

  <!-- 2. Wellness Section -->
  <div class="bg-white shadow-lg rounded-2xl p-6 hover:shadow-xl transition">
    <h3 class="text-lg font-semibold text-primary-900 mb-4"><i class="fas fa-heartbeat mr-2"></i>Wellness</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Energy Level -->
      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-700 mb-1"><i class="fas fa-bolt mr-1"></i>Energy Level</label>
        {{ form.energy_level|add_class:"w-full" }}
        {% if form.energy_level.errors %}
          <p class="text-sm text-warning-700 mt-1">{{ form.energy_level.errors|join:", " }}</p>
        {% endif %}
      </div>
      <!-- Sleep Hours -->
      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-700 mb-1"><i class="fas fa-bed mr-1"></i>Sleep Hours</label>
        {{ form.sleep_hours|add_class:"w-full" }}
        {% if form.sleep_hours.errors %}
          <p class="text-sm text-warning-700 mt-1">{{ form.sleep_hours.errors|join:", " }}</p>
        {% endif %}
      </div>
      <!-- Stress Level -->
      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-700 mb-1"><i class="fas fa-exclamation-triangle mr-1"></i>Stress Level</label>
        {{ form.stress_level|add_class:"w-full" }}
        {% if form.stress_level.errors %}
          <p class="text-sm text-warning-700 mt-1">{{ form.stress_level.errors|join:", " }}</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- 3. Body Measurements Section -->
  <div class="bg-white shadow-lg rounded-2xl p-6 hover:shadow-xl transition">
    <h3 class="text-lg font-semibold text-primary-900 mb-4 cursor-pointer" onclick="document.getElementById('body-measurements').classList.toggle('hidden')">
      <i class="fas fa-ruler-combined mr-2"></i>Body Measurements
      <i class="fas fa-chevron-down float-right"></i>
    </h3>
    <div id="body-measurements" class="grid grid-cols-1 md:grid-cols-3 gap-4 hidden">
      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-700">Current Weight (kg)</label>
        {{ form.current_weight|add_class:"w-full" }}
      </div>
      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-700">Chest (cm)</label>
        {{ form.chest_measurement|add_class:"w-full" }}
      </div>
      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-700">Waist (cm)</label>
        {{ form.waist_measurement|add_class:"w-full" }}
      </div>
      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-700">Hip (cm)</label>
        {{ form.hip_measurement|add_class:"w-full" }}
      </div>
      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-700">Arm (cm)</label>
        {{ form.arm_measurement|add_class:"w-full" }}
      </div>
      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-700">Thigh (cm)</label>
        {{ form.thigh_measurement|add_class:"w-full" }}
      </div>
    </div>
  </div>

  <!-- 4. Notes & Feedback Section -->
  <div class="bg-white shadow-lg rounded-2xl p-6 hover:shadow-xl transition">
    <h3 class="text-lg font-semibold text-primary-900 mb-4 flex justify-between items-center cursor-pointer"
        onclick="document.getElementById('notes-feedback').classList.toggle('hidden'); this.querySelector('i').classList.toggle('rotate-180')">
      <span><i class="fas fa-sticky-note mr-2"></i>Notes & Feedback</span>
      <i class="fas fa-chevron-down transition-transform duration-200"></i>
    </h3>

    <div id="notes-feedback" class="hidden space-y-4">
      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-700 mb-1">Client Notes</label>
        {{ form.notes|add_class:"w-full h-24 px-4 py-2 border border-primary-300 rounded-xl focus:ring-2 focus:ring-primary-400 focus:outline-none transition shadow-sm" }}
        {% if form.notes.errors %}
          <p class="text-sm text-warning-700 mt-1">{{ form.notes.errors|join:", " }}</p>
        {% endif %}
      </div>

      {% if user.is_trainer %}
      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-700 mb-1">Trainer Feedback</label>
        {{ form.trainer_feedback|add_class:"w-full h-24 px-4 py-2 border border-primary-300 rounded-xl focus:ring-2 focus:ring-primary-400 focus:outline-none transition shadow-sm" }}
        {% if form.trainer_feedback.errors %}
          <p class="text-sm text-warning-700 mt-1">{{ form.trainer_feedback.errors|join:", " }}</p>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </div>

  <!-- 5. Progress Photo -->
  <div class="bg-white shadow-lg rounded-2xl p-6 hover:shadow-xl transition">
    <h3 class="text-lg font-semibold text-primary-900 mb-4"><i class="fas fa-camera mr-2"></i>Progress Photo</h3>
    {{ form.progress_photo|add_class:"w-full" }}
    {% if form.progress_photo.errors %}
      <p class="text-sm text-warning-700 mt-1">{{ form.progress_photo.errors|join:", " }}</p>
    {% endif %}
  </div>

</div>
{% endblock %}

{% block submit_text %}Save Progress{% endblock %}
