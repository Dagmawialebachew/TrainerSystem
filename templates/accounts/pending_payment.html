{% extends "base.html" %}

{% block title %}Payment Required{% endblock %}

{% block content %}
<div class="max-w-md mx-auto mt-20">
  <div class="bg-white shadow-xl rounded-2xl p-8 text-center">
    {# Status badge #}
    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold
      {% if reason == 'expired' %}
        bg-red-50 text-red-700 ring-1 ring-red-100
      {% elif reason == 'grace' %}
        bg-yellow-50 text-yellow-700 ring-1 ring-yellow-100
      {% else %}
        bg-blue-50 text-blue-700 ring-1 ring-blue-100
      {% endif %}
    ">
      {% if reason == 'expired' %}Subscription expired{% elif reason == 'grace' %}Grace period{% else %}Payment pending{% endif %}
    </div>

    <h2 class="mt-4 text-2xl font-bold text-gray-900">
      {% if reason == 'expired' %}
        Your subscription has ended
      {% elif reason == 'grace' %}
        Action needed to keep access
      {% else %}
        Complete payment to continue
      {% endif %}
    </h2>

    <p class="mt-3 text-sm text-gray-600">
      {% if reason == 'expired' %}
        Your plan {% if plan_name %}<strong>{{ plan_name }}</strong>{% endif %} expired{% if expired_on %} on <strong>{{ expired_on }}</strong>{% endif %}. Renew now to restore full access.
      {% elif reason == 'grace' %}
        Your billing issue needs attention. You’re in a grace period{% if grace_ends_on %} until <strong>{{ grace_ends_on }}</strong>{% endif %}. Update payment to avoid interruption.
      {% else %}
        We couldn’t verify an active payment for your account. Please complete your subscription to access the dashboard.
      {% endif %}
    </p>

    {# Amount / plan summary #}
    {% if amount_due and currency %}
      <div class="mt-5 rounded-xl bg-gray-50 p-4 text-left">
        <div class="flex items-center justify-between">
          <div class="text-sm text-gray-600">
            <p class="font-medium text-gray-800">Amount due</p>
            {% if plan_name %}<p class="text-xs text-gray-500">Plan: {{ plan_name }}</p>{% endif %}
            {% if period_label %}<p class="text-xs text-gray-500">Billing: {{ period_label }}</p>{% endif %}
            {% if invoice_id %}<p class="text-[11px] text-gray-400 mt-1">Invoice: {{ invoice_id }}</p>{% endif %}
          </div>
          <div class="text-right">
            <p class="text-2xl font-semibold text-gray-900">{{ currency }} {{ amount_due }}</p>
            {% if renew_until %}<p class="text-xs text-gray-500">Renews until {{ renew_until }}</p>{% endif %}
          </div>
        </div>
      </div>
    {% endif %}

    {# Actions #}
    <div class="mt-6 flex flex-col gap-3">
      {% if pay_url %}
        <a href="{{ pay_url }}"
           class="inline-flex justify-center items-center w-full px-4 py-2.5 rounded-lg bg-primary-600 text-white font-semibold hover:bg-primary-700 transition">
          Pay now
        </a>
      {% endif %}
      {% if manage_billing_url %}
        <a href="{{ manage_billing_url }}"
           class="inline-flex justify-center items-center w-full px-4 py-2.5 rounded-lg border border-gray-300 text-gray-800 font-medium hover:bg-gray-50 transition">
          Update billing details
        </a>
      {% endif %}
      <a href="{% url 'accounts:logout' %}"
         class="inline-flex justify-center items-center w-full px-4 py-2.5 rounded-lg text-gray-500 hover:text-gray-700">
        Sign out
      </a>
    </div>

    {# Support #}
    <p class="mt-6 text-xs text-gray-500">
      Need help?
      {% if support_phone %}Call <strong>{{ support_phone }}</strong>{% endif %}
      {% if support_email %} or email <strong>{{ support_email }}</strong>{% endif %}.
    </p>

    {# Optional back link if you allow limited access #}
    {% if back_url %}
      <a href="{{ back_url }}" class="mt-4 inline-block text-sm text-primary-600 hover:underline">Back</a>
    {% endif %}
  </div>

  {# Optional: small note about access #}
  <p class="mt-4 text-center text-xs text-gray-500">
    Access to the dashboard is restored immediately after successful payment.
  </p>
</div>
{% endblock %}
