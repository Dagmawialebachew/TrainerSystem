{% extends "base.html" %}
{% block content %}
<div class="px-6 py-10">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-3xl font-bold text-primary-900 flex items-center gap-3">
      <i class="fas fa-file-invoice-dollar text-primary-500"></i> Billing History
    </h1>
    <div class="flex flex-wrap gap-2">
      <a href="{% url 'payments:dashboard' %}" class="bg-indigo-600 text-white px-4 py-2 rounded-xl font-medium shadow hover:bg-indigo-700 transition text-sm flex items-center space-x-1">
        <i class="fas fa-chart-line"></i><span>Payment Dashboard</span>
      </a>
      <a href="{% url 'payments:create' %}" class="bg-success-600 text-white px-4 py-2 rounded-xl font-medium shadow hover:bg-success-700 transition text-sm flex items-center space-x-1">
        <i class="fas fa-plus-circle"></i><span>New Payment</span>
      </a>
    </div>
  </div>
  <!-- Additional billing content goes here -->
</div>


  <!-- Filter Form -->
  <form method="get" class="mb-8 flex flex-wrap gap-4 items-end bg-white p-4 rounded-xl shadow-sm border border-gray-200">
    <input type="text" name="search" placeholder="Search client or notes"
      value="{{ request.GET.search }}"
      class="w-full sm:w-64 px-4 py-2 border rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500">

  <div class="flex flex-col sm:flex-row items-center gap-2">
  <!-- Status Filter -->
  <label class="flex items-center gap-2 text-sm text-gray-700">
    <i class="fas fa-info-circle text-primary-500"></i>
    <span>Status</span>
  </label>
  <select name="status" class="px-4 py-2 border rounded-md shadow-sm bg-white">
    <option value="">All Statuses</option>
    {% for key, label in status_choices %}
      <option value="{{ key }}" {% if request.GET.status == key %}selected{% endif %}>{{ label }}</option>
    {% endfor %}
  </select>
</div>

<div class="flex flex-col sm:flex-row items-center gap-2">
  <!-- Type Filter -->
  <label class="flex items-center gap-2 text-sm text-gray-700">
    <i class="fas fa-tags text-primary-500"></i>
    <span>Type</span>
  </label>
  <select name="payment_type" class="px-4 py-2 border rounded-md shadow-sm bg-white">
    <option value="">All Types</option>
    {% for key, label in payment_type_choices %}
      <option value="{{ key }}" {% if request.GET.payment_type == key %}selected{% endif %}>{{ label }}</option>
    {% endfor %}
  </select>
</div>


    <button type="submit" class="bg-primary-600 text-white px-4 py-2 rounded-md shadow hover:bg-primary-700">
      <i class="fas fa-filter"></i> Filter
    </button>
  </form>

  <!-- Payment Table -->
  <div class="bg-white shadow rounded-xl overflow-x-auto border border-gray-100">
    <table class="min-w-full divide-y divide-gray-200 text-sm">
      <thead class="bg-gray-50 text-xs uppercase tracking-wide text-gray-600 sticky top-0 z-10">
        <tr>
          <th class="px-4 py-3">Client</th>
          <th class="px-4 py-3">Type</th>
          <th class="px-4 py-3">Amount</th>
          <th class="px-4 py-3">Status</th>
          <th class="px-4 py-3">Due Date</th>
          <th class="px-4 py-3">Paid Date</th>
          <th class="px-4 py-3">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        {% for payment in payments %}
        <tr class="hover:bg-gray-50 transition duration-100">
          <td class="px-4 py-3 font-medium text-gray-800">{{ payment.client.user.get_full_name }}</td>
          <td class="px-4 py-3 text-gray-700">{{ payment.get_payment_type_display }}</td>
          <td class="px-4 py-3 text-green-700 font-semibold">
            {{ payment.amount }} {{ payment.currency }}
          </td>
          <td class="px-4 py-3">
            <span class="inline-block px-2 py-1 rounded-full text-xs font-medium
              {% if payment.status == 'completed' %}bg-green-100 text-green-700
              {% elif payment.status == 'pending' %}bg-yellow-100 text-yellow-700
              {% elif payment.status == 'failed' %}bg-red-100 text-red-700
              {% elif payment.status == 'refunded' %}bg-blue-100 text-blue-700
              {% else %}bg-gray-100 text-gray-700{% endif %}">
              {{ payment.get_status_display }}
            </span>
          </td>
          <td class="px-4 py-3 text-gray-700">{{ payment.due_date|date:"M d, Y" }}</td>
          <td class="px-4 py-3 text-gray-700">
            {% if payment.paid_date %}
              {{ payment.paid_date|date:"M d, Y H:i" }}
            {% else %}
              <span class="text-gray-400 italic">N/A</span>
            {% endif %}
          </td>

         <td class="px-4 py-3 text-gray-700">
  <div class="flex flex-wrap justify-end space-x-2">
    <!-- View Button -->
    <a href="{% url 'payments:detail' payment.pk %}"
       class="text-success-600 font-medium flex items-center space-x-1 hover:underline"
       aria-label="View Payment">
      <i class="fas fa-eye"></i> <span>View</span>
    </a>

    <!-- Edit Button -->
    <a href="{% url 'payments:update' payment.pk %}"
       class="text-warning-600 font-medium flex items-center space-x-1 hover:underline"
       aria-label="Edit Payment">
      <i class="fas fa-edit"></i> <span>Edit</span>
    </a>

    <!-- Delete Button -->
    <form action="{% url 'payments:delete' payment.pk %}" method="post" onsubmit="return confirm('Are you sure you want to delete this payment?')">
      {% csrf_token %}
      <button type="submit"
              class="text-danger-600 font-medium flex items-center space-x-1 hover:underline"
              aria-label="Delete Payment">
        <i class="fas fa-trash"></i> <span>Delete</span>
      </button>
    </form>
  </div>
</td>


        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="px-4 py-6 text-center text-gray-500">
            <div class="flex flex-col items-center justify-center gap-2">
              <i class="fas fa-money-check-alt text-2xl text-gray-300"></i>
              <p class="text-sm">No payments found. Try adjusting your filters.</p>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if is_paginated %}
  <div class="mt-6 flex justify-center items-center gap-2 text-sm">
    {% if page_obj.has_previous %}
      <a href="?page=1{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.payment_type %}&payment_type={{ request.GET.payment_type }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
         class="px-3 py-1 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 transition">
        <i class="fas fa-angle-double-left"></i> First
      </a>
      <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.payment_type %}&payment_type={{ request.GET.payment_type }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
         class="px-3 py-1 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 transition">
        <i class="fas fa-angle-left"></i> Prev
      </a>
    {% endif %}

    <span class="px-3 py-1 rounded bg-primary-100 text-primary-700 font-semibold">
      Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </span>

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.payment_type %}&payment_type={{ request.GET.payment_type }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
         class="px-3 py-1 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 transition">
        Next <i class="fas fa-angle-right"></i>
      </a>
      <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.payment_type %}&payment_type={{ request.GET.payment_type }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
         class="px-3 py-1 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 transition">
        Last <i class="fas fa-angle-double-right"></i>
      </a>
    {% endif %}
  </div>
{% endif %}

</div>
{% endblock %}
